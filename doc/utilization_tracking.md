# Utilization tracking

This tracks the utilization of point-to-point network devices / links.

It encompasses the following files:

* `model/core/ptop-utilization-tracker.cc/h` - Utilization tracker
* `helper/core/ptop-utilization-tracker-helper.cc/h` - Helper to install the utilization trackers on the network devices in a topology.

You can use the application(s) separately, or make use of the helper which requires a topology (which is recommended).


## Getting started

1. Add the following to the `config_ns3.properties` in your run folder (for tracking utilization at a 100ms granularity):

   ```
   enable_link_utilization_tracking=true
   link_utilization_tracking_interval_ns=100000000
   ```

2. In your code, import the helper:

   ```
   #include "ns3/ptop-utilization-tracker-helper.h"
   ```
   
3. Before the start of the simulation run, in your code add:

   ```c++
   // Install utilization trackers
   PtopUtilizationTrackerHelper utilTrackerHelper = PtopUtilizationTrackerHelper(basicSimulation, topology);
   ```

4. After the run, in your code add:

   ```c++
   // Write utilization result
   utilTrackerHelper.WriteResults();
   ```
   
5. After the run, you should have the utilization log files in the `logs_ns3` of your run folder.


## Helper information

You MUST set the following key in `config_ns3.properties` for utilization tracking to be enabled:

* `enable_link_utilization_tracking` : True iff link utilization tracking on all links should be enabled (boolean value, either `true` or `false`)
* `link_utilization_tracking_interval_ns` : The aggregation interval, this effectively determines the granularity of the utilization results. Setting it too low will cause a lot of overhead, setting it too high will make the results less fine. (positive integer value in nanoseconds)


**The utilization log files**

There are two log files generated by the run in the `logs_ns3` folder within the run folder:

* `utilization.csv` : CSV formatted utilization at the interval level. The format is as follows:

  ```
   <from>,<to>,<interval start (ns)>,<interval end (ns)>,<amount of busy in this interval (ns)>
  ```

* `utilization_compressed.csv` : CSV formatted utilization at the interval level, but adjacent intervals with the same utilization (approximately) are joined together. Particularly handy for plotting. The format is as follows:

   ```
   <from>,<to>,<interval start (ns)>,<interval end (ns)>,<amount of busy in this interval (ns)>
   ```

* `utilization_compressed.txt` : Human readable table showing utilization at the interval level, but compressing together the adjacent intervals which have the same utilization (approximately).

* `utilization_summary.txt` : Human readable table of the mean utilization of each link
